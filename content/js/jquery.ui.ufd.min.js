(function(c){var b="ui.ufd";c.widget(b,{_init:function(){if(!this.created){this._create()}},_create:function(){if(this.created){return}this.created=true;if(this.element[0].tagName.toLowerCase()!="select"){this.destroy();return false}this.options=c.extend(true,{},this.options);this.visibleCount=0;this.selectbox=this.element;this.logNode=c(this.options.logSelector);this.overflowCSS=this.options.allowLR?"overflow":"overflowY";var d=this.selectbox.attr("name");var f=this.options.prefix+d;var h=this.options.submitFreeText?d:f;var g="";var e=this.selectbox.attr("id");if(e){g=this.options.prefix+e;this.labels=c("label[for='"+e+"']").attr("for",g)}if(this.options.submitFreeText){this.selectbox.attr("name",f)}if(this.options.calculateZIndex){this.options.zIndexPopup=this._calculateZIndex()}var i=this.options.css;this.css=this.options.css;if(this.options.useUiCss){c.extend(this.css,this.options.uiCss)}if(!i.skin){i.skin=this.options.skin}this.wrapper=c(['<span class="',i.wrapper," ",i.hidden," ",i.skin,'">','<input type="text" id="',g,'" class="',i.input,'" name="',h,'"/>','<button type="button" tabindex="-1" class="',i.button,'"><div class="',i.buttonIcon,'"/></button>',"</span>"].join(""));this.dropdown=c(['<div class="',i.skin,'">','<div class="',i.listWrapper," ",i.hidden,'">','<div class="',i.listScroll,'">',"</div>","</div>","</div>"].join(""));this.selectbox.after(this.wrapper);this.getDropdownContainer().append(this.dropdown);this.input=this.wrapper.find("input");this.button=this.wrapper.find("button");this.listWrapper=this.dropdown.children(":first").css("z-index",this.options.zIndexPopup);this.listScroll=this.listWrapper.children(":first");if(c.fn.bgiframe){this.listWrapper.bgiframe()}if(!this.options.listWidthFixed){this.listWrapper.css({width:50,"min-width":100});this.options.listWidthFixed=(this.listWrapper.width()<100);this.listWrapper.css({width:null,"min-width":null})}this._populateFromMaster();this._initEvents()},_initEvents:function(){var e=this;var f=c.ui.keyCode;var i,j,h,d;var g=this.options.css;this.input.bind("keydown keypress keyup",function(k){j=(k.type=="keydown");h=(k.type=="keypress");d=(k.type=="keyup");i=null;if(undefined===k.which){i=k.keyCode}else{if(!h&&k.which!=0){i=k.keyCode}else{return}}switch(i){case f.HOME:case f.END:if(e.options.homeEndForCursor){return}case f.DOWN:case f.PAGE_DOWN:case f.UP:case f.PAGE_UP:case f.ENTER:e.stopEvent(k);default:}if(!d==((i!=f.TAB)&&(i!=f.ENTER))){return}e.lastKey=i;switch(i){case f.SHIFT:case f.CONTROL:break;case f.DOWN:e.selectNext(false);break;case f.PAGE_DOWN:e.selectNext(true);break;case f.END:e.selectLast();break;case f.UP:e.selectPrev(false);break;case f.PAGE_UP:e.selectPrev(true);break;case f.HOME:e.selectFirst();break;case f.ENTER:e.hideList();e.tryToSetMaster();e.inputFocus();break;case f.TAB:e.realLooseFocusEvent();break;case f.ESCAPE:e.hideList();e.revertSelected();break;default:e.showList();e.filter(false,true);break}});this.input.bind("click",function(k){if(e.isDisabled){e.stopEvent(k);return}if(!e.listVisible()){e.filter(true);e.inputFocus();e.showList()}});this.input.bind("focus",function(k){if(e.isDisabled){e.stopEvent(k);return}if(!e.internalFocus){e.realFocusEvent()}});this.button.bind("mouseover",function(k){e.button.addClass(g.buttonHover)});this.button.bind("mouseout",function(k){e.button.removeClass(g.buttonHover)});this.button.bind("mousedown",function(k){e.button.addClass(g.buttonMouseDown)});this.button.bind("mouseup",function(k){e.button.removeClass(g.buttonMouseDown)});this.button.bind("click",function(k){if(e.isDisabled){e.stopEvent(k);return}if(e.listVisible()){e.hideList();e.inputFocus()}else{e.filter(true);e.inputFocus();e.showList()}});this.listScroll.bind("mouseover mouseout click",function(l){if("LI"==l.target.nodeName.toUpperCase()){if(e.setActiveTimeout){clearTimeout(e.setActiveTimeout);e.setActiveTimeout==null}if("mouseout"==l.type){c(l.target).removeClass(g.liActive);e.setActiveTimeout=setTimeout(function(){c(e.selectedLi).addClass(g.liActive)},e.options.delayYield)}else{if("mouseover"==l.type){if(e.selectedLi!=l.target){c(e.selectedLi).removeClass(g.liActive)}c(l.target).addClass(g.liActive)}else{e.stopEvent(l);var k=c.trim(c(l.target).text());e.input.val(k);e.setActive(l.target);if(e.tryToSetMaster()){e.hideList();e.filter(true);e._triggerEventOnMaster("change")}e.inputFocus()}}}return true});this.selectbox.bind("change."+b,function(k){if(e.isUpdatingMaster){e.isUpdatingMaster=false;return true}e.revertSelected()});this._myDocClickHandler=function(k){if((e.button.get(0)==k.target)||(e.input.get(0)==k.target)){return}if(e.internalFocus){e.realLooseFocusEvent()}};c(document).bind("click."+b,this._myDocClickHandler);if(this.options.polling){var e=this;this._myPollId=setInterval(function(){if(!e.dimensioned){e.setDimensions()}if(e.selectbox[0].disabled!=e.isDisabled){(e.selectbox[0].disabled)?e.disable():e.enable()}},e.options.polling)}},realFocusEvent:function(){this.internalFocus=true;this._triggerEventOnMaster("focus");this.wrapper.addClass(this.options.css.skin+"-"+this.options.css.inputFocus);this.input.addClass(this.options.css.inputFocus);this.button.addClass(this.options.css.inputFocus);this.filter(true);this.inputFocus();this.showList()},realLooseFocusEvent:function(){this.internalFocus=false;this.hideList();this.wrapper.removeClass(this.options.css.skin+"-"+this.options.css.inputFocus);this.input.removeClass(this.options.css.inputFocus);this.button.removeClass(this.options.css.inputFocus);this.tryToSetMaster();this._triggerEventOnMaster("blur")},_triggerEventOnMaster:function(d){if(document.createEvent){var e=document.createEvent("HTMLEvents");e.initEvent(d,true,true);this.selectbox.get(0).dispatchEvent(e)}else{if(document.createEventObject){if(d=="change"&&c.browser.msie&&c.browser.version<9){this.selectbox.change()}this.selectbox.get(0).fireEvent("on"+d)}}},inputFocus:function(){this.input.focus();if(this.getCurrentTextValue().length){this.selectAll()}},inputBlur:function(){this.input.blur()},showList:function(){if(this.listVisible()){return}this.listWrapper.removeClass(this.css.hidden);this.setListDisplay()},hideList:function(){if(!this.listVisible()){return}this.listWrapper.addClass(this.css.hidden);this.listItems.removeClass(this.css.hidden)},filter:function(f,g){var d=this;if(this.updateOnTimeout){clearTimeout(this.updateOnTimeout)}if(this.filterOnTimeout){clearTimeout(this.filterOnTimeout)}this.updateOnTimeout=null;this.filterOnTimeout=null;var h=d.getCurrentTextValue();var e=function(){var j=d.trie.find(h);d.trie.matches=j.matches;d.trie.misses=j.misses;d.updateOnTimeout=setTimeout(function(){i()},d.options.delayYield)};var i=function(){var l=d.getActive();if(d.options.addEmphasis){d.emphasis(d.trie.matches,true,h)}d.visibleCount=d.overwriteClass(d.trie.matches,"");if(f||!d.trie.matches.length){d.visibleCount+=d.overwriteClass(d.trie.misses,"");if(d.options.addEmphasis){d.emphasis(d.trie.misses,false,h)}}else{d.overwriteClass(d.trie.misses,d.css.hidden)}var j=l.hasClass(d.css.hidden);if(!j&&l.length&&d.trie.matches.length){d.setActive(l.get(0))}else{var k=d.listItems.filter(":visible:first");d.setActive(k.get(0))}d.setListDisplay()};if(g){this.filterOnTimeout=setTimeout(function(){e()},this.options.delayFilter)}else{e()}},_encodeDom:c("<div/>"),_encodeString:function(d){return c.trim(this._encodeDom.text(d).html())},emphasis:function(h,j,m){var i,e,n,k,l,d,g;var f=m.length||0;var o=this.selectbox.get(0).options;e=h.length;j=(j&&f>0);if(j){g=this._encodeString(m).replace(/([\\\^\$*+[\]?{}.=!:(|)])/g,"\\$1");d=new RegExp("("+g+")","gi");this.hasEmphasis=true}while(e--){i=h[e];n=i.length;while(n--){k=i[n];l=c.trim(o[k.getAttribute("name")].innerHTML);k.innerHTML=j?l.replace(d,"<em>$1</em>"):l}}},_timingMeasure_firebug:function(d,e){if(d){console.time(e)}else{console.timeEnd(e)}},_timingMeasure:function(d,e){this._timingMeasure_firebug(d,e)},removeEmphasis:function(){if(!this.hasEmphasis){return}this.hasEmphasis=false;var f=this.selectbox.get(0).options;var e=this.list.get(0).getElementsByTagName("LI");var g=e.length;var d;while(g--){var d=e[g];d.innerHTML=c.trim(f[d.getAttribute("name")].innerHTML)}},tryToSetMaster:function(){var f=null;var g=this.getActive();if(g.length){f=g.attr("name")}if(f==null||f==""||f<0){if(this.options.submitFreeText){return false}else{this.revertSelected();return false}}var h=this.selectbox.get(0);var d=h.selectedIndex;var e=h.options[f];if(!this.options.submitFreeText||this.input.val()==e.text){this.input.val(e.text);if(f!=d){this.isUpdatingMaster=true;h.selectedIndex=f}if(!this.listVisible()){this._triggerEventOnMaster("change")}return true}return false},_populateFromMaster:function(){var k=!this.selectbox.filter("[disabled]").length;this.disable();this.trie=new a(this.options.infix,this.options.caseSensitive);this.trie.matches=[];this.trie.misses=[];var f=this;var i=[];i.push("<ul>");var h=this.selectbox.get(0).options;var j,d,g;d=h.length;g=0;while(d--){j=h[g++];i.push('<li name="');i.push(j.index);i.push('">');i.push(c.trim(j.innerHTML));i.push("</li>")}i.push("</ul>");this.listScroll.html(i.join(""));this.list=this.listScroll.find("ul:first");var e=this.list.get(0).getElementsByTagName("LI");this.listItems=c(e);this.selectedLi=null;d=e.length;g=0;while(d--){j=h[g];f.trie.add(c.trim(j.text),e[g++])}this.visibleCount=e.length;this.setInputFromMaster();this.dimensioned=false;this.setDimensions();if(k){this.enable()}this._moveAttrs(this.selectbox,this.input,this.options.moveAttrs)},_moveAttrs:function(j,f,e){for(var g=0;g<e.length;++g){var d=e[g];var h=j.attr(d);if(h){f.attr(d,h);j.removeAttr(d)}}},setDimensions:function(){if(!this.selectIsWrapped&&!this.selectbox.filter(":visible").length){return}if(this.selectIsWrapped&&!this.wrapper.filter(":visible").length){return}this.wrapper.addClass(this.css.hidden);if(this.selectIsWrapped&&(!this.options.manualWidth||this.options.unwrapForCSS)){this.wrapper.before(this.selectbox);this.selectIsWrapped=false}var l;if(this.options.manualWidth){l=this.options.manualWidth}else{l=this.selectbox.outerWidth();if(l<this.options.minWidth){l=this.options.minWidth}else{if(this.options.maxWidth&&(l>this.options.maxWidth)){l=this.options.maxWidth}}}var i=this.options.mimicCSS;for(propPtr in i){var d=i[propPtr];if(!i.hasOwnProperty(propPtr)||typeof d==="function"){continue}this.wrapper.css(d,this.selectbox.css(d))}if(!this.selectIsWrapped){this.wrapper.get(0).appendChild(this.selectbox.get(0));this.selectIsWrapped=true}this.wrapper.removeClass(this.css.hidden);this.listWrapper.removeClass(this.css.hidden);var j=this.button.outerWidth(true);var f=this.wrapper.outerWidth()-this.wrapper.width();var e=this.input.outerWidth(true)-this.input.width();var h=this.listScroll.outerWidth()-this.listScroll.width();var g=l-j-e;this.input.width(g);this.wrapper.width(l);var k=this.options.listWidthFixed?"width":"min-width";this.listWrapper.css(k,l+f);this.listScroll.css(k,l+f-h);this.listWrapper.addClass(this.css.hidden);this.dimensioned=true},setInputFromMaster:function(){var e=this.selectbox.get(0);var d=e.selectedIndex;if(d>-1){this.input.val(e.options[d].text);this.selectedLi=this.listItems.get(d)}},revertSelected:function(){this.setInputFromMaster();this.filter(true)},setListDisplay:function(){if(!this.itemHeight){this.itemHeight=this.listItems.filter("li:first").outerHeight(true)}var k;if(this.visibleCount>this.options.listMaxVisible){k=this.options.listMaxVisible*this.itemHeight;this.listScroll.css(this.overflowCSS,"scroll")}else{k=this.visibleCount*this.itemHeight;this.listScroll.css(this.overflowCSS,"hidden")}this.listScroll.height(k);var j=this.listScroll.outerHeight();this.listWrapper.height(j);var f=this.wrapper.offset();var d=this.wrapper.outerHeight();var i=f.top+d+j;var g=c(window).height()+c(document).scrollTop();var l=(i>g);var e=f.left;var h;if(l){this.listWrapper.addClass(this.css.listWrapperUp);h=(f.top-j)}else{this.listWrapper.removeClass(this.css.listWrapperUp);h=(f.top+d)}this.listWrapper.css("left",e);this.listWrapper.css("top",h);this.scrollTo();return k},getActive:function(){if(this.selectedLi==null){return c([])}return c(this.selectedLi)},setActive:function(d){c(this.selectedLi).removeClass(this.css.liActive);this.selectedLi=d;c(this.selectedLi).addClass(this.css.liActive)},selectFirst:function(){var d=this.listItems.filter(":not(.invisible):first");this.afterSelect(d)},selectLast:function(){var d=this.listItems.filter(":not(.invisible):last");this.afterSelect(d)},selectPrev:function(f){var e=f?this.options.pageLength:1;var d=this.searchRelativeVisible(false,e);this.afterSelect(d)},selectNext:function(f){var e=f?this.options.pageLength:1;var d=this.searchRelativeVisible(true,e);this.afterSelect(d)},afterSelect:function(d){if(d==null){return}this.setActive(d);this.input.val(d.text());this.scrollTo();this.tryToSetMaster();this.inputFocus();this.removeEmphasis()},searchRelativeVisible:function(e,f){var g=this.getActive();if(!g.length){this.selectFirst();return null}var d;do{d=g;do{d=e?d.next():d.prev()}while(d.length&&d.hasClass(this.css.hidden));if(d.length){g=d}}while(--f);return g},scrollTo:function(){if("scroll"!=this.listScroll.css(this.overflowCSS)){return false}var j=this.getActive();if(!j.length){return false}var f=Math.floor(j.position().top);var d=j.outerHeight(true);var e=this.listWrapper.height();var i=this.listScroll.scrollTop();var h;var g=(this.options.viewAhead*d);if(f<g){h=i+f-g}else{if((f+d)>=(e-g)){h=i+f-e+d+g}else{return false}}this.listScroll.scrollTop(h);return true},getCurrentTextValue:function(){var d=c.trim(this.input.val());return d},stopEvent:function(d){d=d?d:window.event;d.cancel=true;d.cancelBubble=true;d.returnValue=false;if(d.stopPropagation){d.stopPropagation()}if(d.preventDefault){d.preventDefault()}},overwriteClass:function(i,h){var f,d,e,g=0;d=i.length;while(d--){f=i[d];e=f.length;g+=e;while(e--){f[e].setAttribute(c.ui.ufd.classAttr,h)}}return g},listVisible:function(){var d=!this.listWrapper.hasClass(this.css.hidden);return d},disable:function(){this.hideList();this.isDisabled=true;this.button.addClass(this.css.buttonDisabled);this.input.addClass(this.css.inputDisabled);this.input.attr("disabled","disabled");this.selectbox.attr("disabled","disabled")},enable:function(){this.isDisabled=false;this.button.removeClass(this.css.buttonDisabled);this.input.removeClass(this.css.inputDisabled);this.input.removeAttr("disabled");this.selectbox.removeAttr("disabled")},selectAll:function(){this.input.get(0).select()},getDropdownContainer:function(){var d=c("#"+this.options.dropDownID);if(!d.length){d=c("<div></div>").appendTo("body").css("height",0).attr("id",this.options.dropDownID)}return d},log:function(d){if(!this.options.log){return}if(window.console&&window.console.log){console.log(d)}if(this.logNode&&this.logNode.length){this.logNode.prepend("<div>"+d+"</div>")}},_calculateZIndex:function(d){var f,e=this.options.zIndexPopup;this.selectbox.parents().each(function(){f=parseInt(c(this).css("zIndex"),10);if(f>e){e=f}});return e+1},changeOptions:function(){this._populateFromMaster()},destroy:function(){if(this.selectIsWrapped){this.wrapper.before(this.selectbox)}this._moveAttrs(this.input,this.selectbox,this.options.moveAttrs);this.labels.attr("for",this.selectbox.attr("id"));this.labels=null;this.selectbox.unbind("change."+b);c(document).unbind("click."+b,this._myDocClickHandler);if(this._myPollId){clearInterval(this._myPollId)}this.wrapper.remove();this.listWrapper.remove();if(c.ui.version<"1.8"){this.selectbox.unbind("setData."+b);this.selectbox.unbind("getData."+b);this.selectbox.unbind("remove");c.widget.prototype.destroy.apply(this,arguments)}else{c.Widget.prototype.destroy.apply(this,arguments)}this.selectbox=null;this._encodeDom=null},dimensioned:false,selectIsWrapped:false,internalFocus:false,lastKey:null,selectedLi:null,isUpdatingMaster:false,created:false,hasEmphasis:false,isDisabled:false});var a=function(e,d){this.isInfix=!!e;this.isCaseSensitive=!!d;this.root=[null,{},false];this.infixRoots=(e)?{}:null};a.prototype.add=function(f,d){f=this.cleanString(f);var j=f.length;var h=this.root;var g,k;for(var e=0;e<j;e++){g=f.charAt(e);k=h[1];if(g in k){h=k[g]}else{h=k[g]=[null,{},this.root[2]];if(this.isInfix){if(g in this.infixRoots){this.infixRoots[g].push(h)}else{this.infixRoots[g]=[h]}}}}if(h[0]){h[0].push(d)}else{h[0]=[d]}return true},a.prototype.find=function(e){var g=this.findNodeArray(e);var f=!this.root[2];var h=[];var d=[];var i;for(arrName in g){i=g[arrName];if(!g.hasOwnProperty(arrName)||typeof i==="function"){continue}this.markAndRetrieve(h,i,f)}this.markAndRetrieve(d,this.root,f);return{matches:h,misses:d}};a.prototype.findNodeArray=function(f){var f=this.cleanString(f);var d=[this.root];var h=f.length;var g;this.cache=this.cache||{};var j=this.cache;for(var e=0;e<h;e++){g=f.charAt(e);if(j.chr==g){d=j.hit}else{d=this.mapNewArray(d,g);j.chr=g;j.hit=d;j.next={}}j=j.next}return d};a.prototype.mapNewArray=function(k,h){if(k.length&&k[0]==this.root){if(this.isInfix){return(this.infixRoots[h]||[])}else{var j=this.root[1][h];return(j)?[j]:[]}}var d=[];var e=k.length;var g;for(var f=0;f<e;f++){g=k[f][1];if(g.hasOwnProperty(h)){d.push(g[h])}}return d};a.prototype.markAndRetrieve=function(h,g,e){var d=[g];while(d.length>0){var f=d.pop();if(f[2]==e){continue}f[2]=e;if(f[0]){h.unshift(f[0])}for(chr in f[1]){if(f[1].hasOwnProperty(chr)){d.push(f[1][chr])}}}};a.prototype.cleanString=function(d){if(!this.isCaseSensitive){d=d.toLowerCase()}return d};c.ui.ufd.getNewTrie=function(d,e){return new a(d,e)};c.extend(c.ui.ufd,{version:"0.6",getter:"",classAttr:((c.support.style||($.browser.msie&&$.browser.version=="8.0"))?"class":"className"),defaults:{skin:"plain",prefix:"ufd-",dropDownID:"ufd-container",logSelector:"#log",mimicCSS:["float","tabindex","marginLeft","marginTop","marginRight","marginBottom"],moveAttrs:["tabindex","title"],infix:true,addEmphasis:false,caseSensitive:false,submitFreeText:false,homeEndForCursor:false,allowLR:false,calculateZIndex:false,useUiCss:false,log:false,unwrapForCSS:false,listWidthFixed:true,polling:250,listMaxVisible:10,minWidth:50,maxWidth:null,manualWidth:null,viewAhead:1,pageLength:10,delayFilter:(c.support.style)?1:150,delayYield:1,zIndexPopup:101,css:{input:"",inputDisabled:"disabled",inputFocus:"focus",button:"",buttonIcon:"icon",buttonDisabled:"disabled",buttonHover:"hover",buttonMouseDown:"mouseDown",li:"",liActive:"active",hidden:"invisible",wrapper:"ufd",listWrapper:"list-wrapper",listWrapperUp:"list-wrapper-up",listScroll:"list-scroll"},uiCss:{skin:"uiCss",input:"ui-widget-content",inputDisabled:"disabled",button:"ui-button",buttonIcon:"ui-icon ui-icon-triangle-1-s",buttonDisabled:"disabled",buttonHover:"ui-state-focus",buttonMouseDown:"ui-state-active",li:"ui-menu-item",liActive:"ui-state-hover",hidden:"invisible",wrapper:"ufd ui-widget ui-widget-content",listWrapper:"list-wrapper ui-widget ui-widget",listWrapperUp:"list-wrapper-up",listScroll:"list-scroll ui-widget-content"}}});c.ui.ufd.prototype.options=c.ui.ufd.defaults})(jQuery);